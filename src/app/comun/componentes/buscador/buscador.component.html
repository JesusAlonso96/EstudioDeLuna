<app-barra-cargando [cargando]="cargando"></app-barra-cargando>
<div class="container-fluid" *ngIf="datosTabla" @primerEstado>
    <div class="row">
        <div class="col-lg-12">
            <mat-form-field class="w-100 input" appearance="outline">
                <mat-label>Buscar {{nombre}}</mat-label>
                <input matInput [(ngModel)]="busquedaElemento" placeholder="Buscar por nombre"
                    (keyup)="aplicarFiltroBusqueda()" autocomplete="off">
                <button *ngIf="busquedaElemento" (click)="borrarBusqueda()" mat-button matSuffix mat-icon-button
                    aria-label="Clear">
                    <mat-icon>close</mat-icon>
                </button>
            </mat-form-field>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12 mb-4">
            <ng-container [ngSwitch]="nombre">
                <ng-container *ngSwitchCase="'proveedor'">
                    <mat-table [dataSource]="datosTabla" matSort>
                        <ng-container matColumnDef="nombre">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.nombre}}</mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="rfc">
                            <mat-header-cell *matHeaderCellDef>RFC</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.rfc}}</mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="telefono">
                            <mat-header-cell *matHeaderCellDef>Telefono</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.telefono}}</mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="ciudad">
                            <mat-header-cell *matHeaderCellDef>Ciudad</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.ciudad}}</mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'borrar'" matColumnDef="borrar">
                            <mat-header-cell *matHeaderCellDef>Eliminar proveedor</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <a class="icono-error" mat-mini-fab
                                    (click)="confirmarEliminacionElemento(element,'proveedor',0)">
                                    <mat-icon>delete</mat-icon>
                                </a>
                            </mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'editar'" matColumnDef="editar">
                            <mat-header-cell *matHeaderCellDef>Editar proveedor</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <a (click)="confirmarEdicionProveedor(element)" mat-mini-fab>
                                    <mat-icon>edit</mat-icon>
                                </a>
                            </mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'restaurar'" matColumnDef="restaurar">
                            <mat-header-cell *matHeaderCellDef>Restaurar proveedor</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <a (click)="confirmarRestauracionElemento(element,'proveedor',0)" mat-mini-fab
                                    color="primary">
                                    <mat-icon>restore_from_trash</mat-icon>
                                </a>
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="noData">
                            <mat-footer-cell *matFooterCellDef colspan="6">
                                No hay {{nombre}}es en esta lista
                            </mat-footer-cell>
                        </ng-container>
                        <mat-header-row *matHeaderRowDef="columnas"></mat-header-row>
                        <mat-row *matRowDef="let row;columns: columnas;"></mat-row>
                        <mat-footer-row *matFooterRowDef="['noData']"
                            [ngClass]="{'hide':!(datosTabla!=null && datosTabla.data.length == 0)}"></mat-footer-row>
                    </mat-table>
                </ng-container>
                <ng-container *ngSwitchCase="'cliente'">
                    <table mat-table *ngIf="!(datosTabla!=null && datosTabla.data.length == 0)" class="w-100" [dataSource]="datosTabla" matSort>
                        <ng-container matColumnDef="nombre">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
                            <td mat-cell *matCellDef="let element">{{element.nombre}}</td>
                        </ng-container>
                        <ng-container matColumnDef="ape_pat">
                            <th mat-header-cell *matHeaderCellDef>Apellido paterno</th>
                            <td mat-cell *matCellDef="let element">{{element.ape_pat}}</td>
                        </ng-container>
                        <ng-container matColumnDef="ape_mat">
                            <th mat-header-cell *matHeaderCellDef>Apellido materno</th>
                            <td mat-cell *matCellDef="let element">{{element.ape_mat}}</td>
                        </ng-container>
                        <ng-container matColumnDef="email">
                            <th mat-header-cell *matHeaderCellDef>Correo electronico</th>
                            <td mat-cell *matCellDef="let element">{{element.email}}</td>
                        </ng-container>
                        <ng-container matColumnDef="telefono">
                            <th mat-header-cell *matHeaderCellDef>Telefono celular</th>
                            <td mat-cell *matCellDef="let element">{{element.telefono}}</td>
                        </ng-container>
                        <ng-container matColumnDef="opciones">
                            <th mat-header-cell class="text-center" *matHeaderCellDef>Opciones</th>
                            <td mat-cell class="text-center" *matCellDef="let element">
                                <button *ngIf="accion == 'administrar'" mat-icon-button
                                    (click)="confirmarEliminacionElemento(element,'cliente',1)" class="icono-error mr-2">
                                    <mat-icon>delete</mat-icon>
                                </button>
                                <button *ngIf="accion == 'administrar'" mat-icon-button
                                    (click)="confirmarEdicionCliente(element)" class="icono-advertencia">
                                    <mat-icon>edit</mat-icon>
                                </button>
                                <button *ngIf="accion == 'restaurar'" mat-icon-button
                                    (click)="confirmarRestauracionElemento(element,'cliente',1)"
                                    class="icono-advertencia">
                                    <mat-icon>restore_from_trash</mat-icon>
                                </button>
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="columnas"></tr>
                        <tr mat-row *matRowDef="let row;columns: columnas;"></tr>
                    </table>
                    <app-alerta *ngIf="(datosTabla!=null && datosTabla.data.length == 0)" tipo="info"
                        tipo_bootstrap="info" mensaje="No hay cajas disponibles en esta seccion"></app-alerta>
                </ng-container>
                <ng-container *ngSwitchCase="'usuario'">
                    <mat-table [dataSource]="datosTabla" matSort>
                        <ng-container matColumnDef="nombre">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.nombre}}</mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="ape_pat">
                            <mat-header-cell *matHeaderCellDef>Apellido paterno</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.ape_pat}}</mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="ape_mat">
                            <mat-header-cell *matHeaderCellDef>Apellido materno</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.ape_mat}}</mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="rol">
                            <mat-header-cell *matHeaderCellDef>Rol</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <span *ngIf="element.rol == 2">Administrador</span>
                                <span *ngIf="element.rol == 1">Supervisor</span>
                                <span *ngIf="element.rol == 0">Empleado</span>
                            </mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'borrar'" matColumnDef="borrar">
                            <mat-header-cell *matHeaderCellDef>Eliminar usuario</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <button (click)="confirmarEliminacionElemento(element,'usuario',2)"
                                    [disabled]="propiaCuenta(element)" mat-mini-fab class="icono-error">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'editar'" matColumnDef="editar">
                            <mat-header-cell *matHeaderCellDef>Editar</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <button mat-mini-fab (click)="confirmarEdicionUsuario(element)" class="editar">
                                    <mat-icon>edit</mat-icon>
                                </button>
                            </mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'editar'" matColumnDef="permisos">
                            <mat-header-cell *matHeaderCellDef>Cambiar permisos</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <button mat-mini-fab (click)="cambiarPermisosUsuario(element)"
                                    [disabled]="!esAdministrador()" color="accent">
                                    <mat-icon>lock</mat-icon>
                                </button>
                            </mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'restaurar'" matColumnDef="restaurar">
                            <mat-header-cell *matHeaderCellDef>Restaurar usuario</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <a (click)="confirmarRestauracionElemento(element,'usuario',2)" mat-mini-fab
                                    color="primary">
                                    <mat-icon>restore_from_trash</mat-icon>
                                </a>
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="noData">
                            <mat-footer-cell *matFooterCellDef colspan="6">
                                No hay usuarios registrados
                            </mat-footer-cell>
                        </ng-container>
                        <mat-header-row *matHeaderRowDef="columnas"></mat-header-row>
                        <mat-row *matRowDef="let row;columns: columnas;"></mat-row>
                        <mat-footer-row *matFooterRowDef="['noData']"
                            [ngClass]="{'hide':!(datosTabla!=null && datosTabla.data.length == 0)}"></mat-footer-row>
                    </mat-table>
                </ng-container>
                <ng-container *ngSwitchCase="'empresa'">
                    <mat-table [dataSource]="datosTabla" matSort>
                        <ng-container matColumnDef="nombre">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.nombre}}</mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="contacto">
                            <mat-header-cell *matHeaderCellDef>Contacto</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.contacto}}</mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="email">
                            <mat-header-cell *matHeaderCellDef>Correo electronico</mat-header-cell>
                            <mat-cell *matCellDef="let element">{{element.email}}</mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'editar'" matColumnDef="editar">
                            <mat-header-cell *matHeaderCellDef>Editar empresa</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <button mat-mini-fab color="accent" (click)="confirmarEdicionEmpresa(element)">
                                    <mat-icon>edit</mat-icon>
                                </button>
                            </mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'editar'" matColumnDef="eliminar">
                            <mat-header-cell *matHeaderCellDef>Eliminar empresa</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <button mat-mini-fab class="icono-error"
                                    (click)="confirmarEliminacionElemento(element,'empresa',3)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </mat-cell>
                        </ng-container>
                        <ng-container *ngIf="accion == 'restaurar'" matColumnDef="restaurar">
                            <mat-header-cell *matHeaderCellDef>Restaurar empresa</mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <a (click)="confirmarRestauracionElemento(element,'empresa',3)" mat-mini-fab
                                    color="primary">
                                    <mat-icon>restore_from_trash</mat-icon>
                                </a>
                            </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="noData">
                            <mat-footer-cell *matFooterCellDef colspan="6">
                                No hay empresas registradas
                            </mat-footer-cell>
                        </ng-container>
                        <mat-header-row *matHeaderRowDef="columnas"></mat-header-row>
                        <mat-row *matRowDef="let row;columns: columnas;"></mat-row>
                        <mat-footer-row *matFooterRowDef="['noData']"
                            [ngClass]="{'hide':!(datosTabla!=null && datosTabla.data.length == 0)}"></mat-footer-row>
                    </mat-table>
                </ng-container>
                <ng-container *ngSwitchCase="'almacen'">
                    <table mat-table class="w-100" [dataSource]="datosTabla" matSort>
                        <ng-container matColumnDef="id">
                            <th class="text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Id</th>
                            <td class="text-center" mat-cell *matCellDef="let element">{{element.id}}</td>
                        </ng-container>
                        <ng-container matColumnDef="nombre">
                            <th class="text-center" mat-header-cell *matHeaderCellDef>Nombre</th>
                            <td class="text-center" mat-cell *matCellDef="let element">{{element.nombre}}</td>
                        </ng-container>
                        <ng-container matColumnDef="direccion">
                            <th class="text-center" mat-header-cell *matHeaderCellDef>Direccion</th>
                            <td class="text-center" mat-cell *matCellDef="let element">{{element.direccion.calle}}
                                {{element.direccion.colonia}} #{{element.direccion.num_ext}}</td>
                        </ng-container>
                        <ng-container *ngIf="accion == 'administrar'" matColumnDef="editar">
                            <th class="text-center" mat-header-cell *matHeaderCellDef>Editar almacen</th>
                            <td class="text-center" mat-cell *matCellDef="let element">
                                <button mat-icon-button class="icono-advertencia" (click)="confirmarEdicionAlmacen(element)">
                                    <mat-icon>edit</mat-icon>
                                </button>
                            </td>
                        </ng-container>
                        <ng-container *ngIf="accion == 'administrar'" matColumnDef="eliminar">
                            <th class="text-center" mat-header-cell *matHeaderCellDef>Eliminar almacen</th>
                            <td mat-cell *matCellDef="let element">
                                <button mat-icon-button class="icono-error"
                                    (click)="confirmarEliminacionElemento(element,'almacen',4)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </td>
                        </ng-container>
                        <ng-container *ngIf="accion == 'restaurar'" matColumnDef="restaurar">
                            <th mat-header-cell *matHeaderCellDef>Restaurar almacen</th>
                            <td mat-cell *matCellDef="let element">
                                <a (click)="confirmarRestauracionElemento(element,'almacen',5)" mat-icon-button
                                    class="icono-advertencia">
                                    <mat-icon>restore_from_trash</mat-icon>
                                </a>
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="columnas"></tr>
                        <tr mat-row *matRowDef="let row;columns: columnas;"></tr>
                    </table>
                    <app-alerta *ngIf="(datosTabla!=null && datosTabla.data.length == 0)" tipo="info"
                        tipo_bootstrap="info" mensaje="No hay almacenes disponibles en esta seccion"></app-alerta>
                </ng-container>
                <ng-container *ngSwitchCase="'cajas'">
                    <table mat-table *ngIf="!(datosTabla!=null && datosTabla.data.length == 0)" class="w-100" 
                        [dataSource]="datosTabla" multiTemplateDataRows matSort>
                        <ng-container matColumnDef="num_caja">
                            <th mat-header-cell class="text-center" *matHeaderCellDef>Numero de caja</th>
                            <td mat-cell class="text-center" *matCellDef="let element">{{element.id}}</td>
                        </ng-container>
                        <ng-container matColumnDef="activa">
                            <th mat-header-cell class="text-center" *matHeaderCellDef>Estado</th>
                            <td mat-cell class="text-center" *matCellDef="let element">
                                <mat-icon [matTooltip]="element.activa ? 'Caja activa' : 'Caja inactiva'"
                                    [ngClass]="{'icono-estado-inactivo':!element.activa,'icono-estado-activo':element.activa}">
                                    lens</mat-icon>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="sucursal">
                            <th mat-header-cell class="text-center" *matHeaderCellDef>Sucursal</th>
                            <td mat-cell class="text-center" *matCellDef="let element">{{element.sucursal.nombre}}</td>
                        </ng-container>
                        <ng-container matColumnDef="opciones">
                            <th mat-header-cell class="text-center" *matHeaderCellDef>Opciones</th>
                            <td mat-cell class="text-center" *matCellDef="let element">
                                <button matTooltip="Eliminar caja" *ngIf="accion == 'administrar'" class="icono-error"
                                    mat-icon-button (click)="confirmarEliminacionElemento(element,'caja',5)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                                <button matTooltip="Restaurar caja" *ngIf="accion == 'restaurar'"
                                    class="icono-advertencia" mat-icon-button
                                    (click)="confirmarRestauracionElemento(element,'caja',6)">
                                    <mat-icon>restore_from_trash</mat-icon>
                                </button>
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="columnas"></tr>
                        <tr mat-row *matRowDef="let row;columns: columnas;"></tr>
                    </table>
                    <app-alerta *ngIf="(datosTabla!=null && datosTabla.data.length == 0)" tipo="info"
                        tipo_bootstrap="info" mensaje="No hay cajas disponibles en esta seccion"></app-alerta>
                </ng-container>
            </ng-container>
            <mat-paginator #paginator [pageSizeOptions]="[5,10,15,20]" [pageSize]="10"></mat-paginator>
        </div>
    </div>
</div>